<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja"
	th:replace="layout/admin_base :: admin_base(~{::content}, '商品管理', ~{::assets})">

<th:block th:fragment="content">
	<div class="table-container">
		<section class="section">
		<h1>商品管理</h1>

		<!-- フラッシュメッセージ -->
		<div th:if="${successMessage}"
			style="padding:8px; margin-bottom:12px; background:#e6ffed; border:1px solid #9ae6b4;">
			<span th:text="${successMessage}"></span>
		</div>
		<div th:if="${errorMessage}"
			style="padding:8px; margin-bottom:12px; background:#ffe6e6; border:1px solid #feb2b2;">
			<span th:text="${errorMessage}"></span>
		</div>

		<!-- 新規商品登録ボタン -->
		<div class="new-item" style="margin-bottom: 16px;">
			<a class="primary-btn" th:href="@{/admin/items/new}">＋ 新規商品登録</a>
		</div>

		<!-- 商品一覧テーブル -->
		<table class="item-table">
			<thead>
				<tr>
					<th>ID</th>
					<th>商品名</th>
					<th>カテゴリ</th>
					<th>価格</th>
					<th>作成日</th>
					<th>登録日</th>
					<th>販売状況</th>
					<th>操作</th>
				</tr>
			</thead>

			<tbody><!-- 商品リストをループ表示 -->
				<tr th:each="item : ${items}"th:classappend="${item.isDeleted} ? 'disabled-row' : ''">

					<!-- 商品IDの表示 -->
					<td th:text="${item.id}">1</td>

					<!-- 商品名の表示-->
					<td th:text="${item.name}">サンプル商品</td>

					<!-- カテゴリの表示-->
					<td th:text="${#lists.isEmpty(item.categoryList) ? '' : item.categoryList[0]}">サンプル</td>

					<!-- 価格の表示 -->
					<td th:text="${#numbers.formatInteger(item.price, 0)} + '円'">1,000 円</td>

					<!-- 商品作成日 -->
					<td th:text="${item.createdAt != null ? #temporals.format(item.createdAt, 'yyyy/MM/dd') : ''}">
						2025/11/11
					</td>
					
					<!-- 商品登録日 -->
					<td th:text="${item.updatedAt != null ? #temporals.format(item.updatedAt, 'yyyy/MM/dd') : ''}">
						2025/11/11
					</td>
					
					<!-- ★販売状況バッジ -->
					<td>
					    <span th:if="${!item.isDeleted}" class="badge-active">
					        販売中
					    </span>
					    <span th:if="${item.isDeleted}" class="badge-ended">
					        販売終了
					    </span>
					</td>

					<td><!-- 操作 -->
					    <div style="display:flex; gap:8px;">

					        <!-- 編集ボタン（常に表示） -->
					        <a class="btn btn-edit"
					           th:href="@{/admin/items/edit/{id}(id=${item.id})}">
					            編集
					        </a>

					        <!-- ★販売中：販売終了（論理削除）ボタン -->
					        <form th:if="${!item.isDeleted}"
					              th:action="@{/admin/items/delete/{id}(id=${item.id})}"
					              method="post"
					              onsubmit="return confirm('この商品を「販売終了」扱いにしますか？');">
					            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					            <button type="submit" class="btn btn-delete">削除</button>
					        </form>

					        <!-- ★販売終了：販売再開ボタン -->
					        <form th:if="${item.isDeleted}"
					              th:action="@{/admin/items/restore/{id}(id=${item.id})}"
					              method="post"
					              onsubmit="return confirm('この商品を再度「販売中」にしますか？');">
					            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					            <button type="submit" class="btn btn-restore">販売再開</button>
					        </form>
					    </div>
					</td>


				<!-- データが無いとき -->
				<tr th:if="${#lists.isEmpty(items)}">
					<td colspan="8" class="no-data" style="text-align:center; padding:12px; color:#888;">
						登録された商品がありません。
					</td>
				</tr>
			</tbody>
		</table>

	</section>
</th:block>


</html>