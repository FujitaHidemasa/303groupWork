<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja"
	th:replace="layout/admin_base :: admin_base(~{::content}, '商品編集', ~{::assets})">

<th:block th:fragment="content">
	<div class="table-container">
		<section class="section">
			<h1>商品編集</h1>

			<!-- エラーメッセージ -->
			<div th:if="${errorMessage}"
				style="padding:8px; margin-bottom:12px; background:#ffe6e6; border:1px solid #feb2b2;">
				<span th:text="${errorMessage}"></span>
			</div>

			<form th:action="@{/admin/items/edit/{id}(id=${item.id})}" method="post" enctype="multipart/form-data">
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

				<div>
					<label for="name">商品名 <span style="color:red;">*</span></label><br>
					<input type="text" id="name" name="name" required style="width:100%;" th:value="${item.name}">
				</div>

				<div>
					<label for="price">価格（円）<span style="color:red;">*</span></label><br>
					<input type="number" id="price" name="price" min="0" step="1" required style="width:200px;"
						th:value="${item.price}">
				</div>

				<div>
					<label for="overview">概要</label><br>
					<textarea id="overview" name="overview" rows="4" style="width:100%;"
						th:text="${item.overview}"></textarea>
				</div>

				<div>
					<label for="categories">カテゴリ（複数ある場合はカンマ区切り）</label><br>
					<input type="text" id="categories" name="categories"
						th:value="${#strings.listJoin(item.categoryList, ', ')}" style="width:100%;">
				</div>

				<div>
					<label>
						<input type="checkbox" id="isDownload" name="isDownload" th:checked="${item.isDownload}">
						DL商品として扱う
					</label>
				</div>

				<div>
					<label for="thumbsImageName">サムネイル画像ファイル名</label><br>
					<div style="display:flex; gap:8px; align-items:center;">
						<input type="text" id="thumbsImageName" name="thumbsImageName" style="flex:1;"
							th:value="${item.thumbsImageName}">
						<button type="button" class="btn btn-secondary"
							onclick="document.getElementById('thumbsFile').click();">
							画像を選択
						</button>
						<input type="file" id="thumbsFile" name="thumbsFile" accept="image/*" style="display:none;"
							onchange="onThumbFileSelected(this)">
					</div>
					<small>※ 新しい画像を選択した場合、そのファイル名で上書きされます。</small>
				</div>

				<div style="display:flex; gap:8px; margin-top:8px;">
					<button type="submit" class="btn btn-edit">保存</button>
					<a th:href="@{/admin/items}" class="btn btn-cancel">キャンセル</a>

					<!-- ★販売再開ボタン（isDeleted = true のときだけ表示） -->
					<div style="margin-top: 16px;" th:if="${item.isDeleted}">
						<form th:action="@{/admin/items/restore/{id}(id=${item.id})}" method="post"
							onsubmit="return confirm('この商品を販売再開しますか？');">
							<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
							<button type="submit" class="btn btn-edit" style="background:#27ae60;">
								販売再開
							</button>
						</form>
					</div>
				</div>
			</form>
		</section>
	</div>
</th:block>

<th:block th:fragment="assets">
	<script>
		function onThumbFileSelected(input) {
			if (!input.files || input.files.length === 0) {
				return;
			}
			const file = input.files[0];
			const nameField = document.getElementById('thumbsImageName');
			if (nameField) {
				nameField.value = file.name;
			}
		}
	</script>
</th:block>


</html>