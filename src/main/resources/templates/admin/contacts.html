<!-- ============================================================
  お問い合わせ管理（Wireframe Version）
  現在はDB未連携のため、仮データを静的に表示しています。

  【今後の実装方針】
  ・このページでは「contacts」テーブル(未作成)を利用し、
    ユーザーからのお問い合わせ内容を一覧表示します。
  ・返信済み／未返信を replied_at の有無で区別します。
  ・管理画面専用の Controller（AdminContactController）を追加し、
    一般ユーザー用の ContactController とはURLを分離します。
  ・Service / Mapper は新規に作成します。
  ・この画面下部に選択した問い合わせの詳細と返信フォームを表示し、
    ブラウザ上から直接返信できるようにします。
============================================================= -->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja"
      th:replace="layout/admin_base :: admin_base(~{::content}, 'お問い合わせ管理', ~{::assets})">

<!-- ページ本体 -->
<th:block th:fragment="content">
  <section class="section">
    <h1>お問い合わせ管理</h1>

    <!-- フィルタ -->
    <form th:action="@{/admin/contacts}" method="get" style="margin-bottom:16px;">
      <label>ステータス：</label>
      <select name="status">
        <option value="ALL" th:selected="${selectedStatus} == 'ALL'">すべて</option>
        <option value="NEW" th:selected="${selectedStatus} == 'NEW'">未対応</option>
        <option value="IN_PROGRESS" th:selected="${selectedStatus} == 'IN_PROGRESS'">対応中</option>
        <option value="RESOLVED" th:selected="${selectedStatus} == 'RESOLVED'">対応済</option>
      </select>
      <button type="submit">絞り込む</button>
    </form>

    <!-- 一覧テーブル -->
    <div class="table-container">
      <table class="admin-table contact-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>受付日時</th>
            <th>名前</th>
            <th>Email</th>
            <th>件名</th>
            <th>ステータス</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="c : ${contacts}">
            <td th:text="${c.id}"
                th:attr="title=${c.id}">1</td>
            <td th:text="${#temporals.format(c.createdAt, 'yyyy/MM/dd HH:mm')}"
                th:attr="title=${#temporals.format(c.createdAt, 'yyyy/MM/dd HH:mm')}">
              2025/11/01 12:00
            </td>
            <td th:text="${c.name}"
                th:attr="title=${c.name}">山田 太郎</td>
            <td th:text="${c.email}"
                th:attr="title=${c.email}">taro@example.com</td>
            <td th:text="${c.subject}"
                th:attr="title=${c.subject}">商品について</td>

            <td th:attr="title=${c.status}">
              <span th:switch="${c.status}">
                <span th:case="'NEW'" style="color:red;">未対応</span>
                <span th:case="'IN_PROGRESS'" style="color:orange;">対応中</span>
                <span th:case="'RESOLVED'" style="color:green;">対応済</span>
                <span th:case="*"
                      th:text="${c.status}">その他</span>
              </span>
            </td>
            <td>
              <div class="contact-actions">
                <!-- 詳細画面へのリンク -->
                <a th:href="@{|/admin/contacts/${c.id}|}">詳細</a>

                <!-- 削除ボタン -->
                <form th:action="@{/admin/contacts/delete}" method="post"
                      onsubmit="return confirm('このお問い合わせを削除します。よろしいですか？');">
                  <input type="hidden" name="id" th:value="${c.id}">
                  <button type="submit" class="btn-delete">削除</button>
                </form>
              </div>
            </td>
          </tr>
          <tr th:if="${#lists.isEmpty(contacts)}">
            <td colspan="7" style="text-align:center;">お問い合わせはまだ登録されていません。</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</th:block>

<!-- ページ固有の CSS など -->
<th:block th:fragment="assets">
  <style>
    .contact-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed; /* 列幅を固定して崩れにくくする */
    }
    .contact-table th,
    .contact-table td {
      border: 1px solid #ccc;
      padding: 8px;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* 各列の幅バランス（必要に応じて微調整OK） */
    .contact-table th:nth-child(1),
    .contact-table td:nth-child(1) { width: 40px; }   /* ID */
    .contact-table th:nth-child(2),
    .contact-table td:nth-child(2) { width: 140px; }  /* 受付日時 */
    .contact-table th:nth-child(3),
    .contact-table td:nth-child(3) { width: 120px; }  /* 名前 */
    .contact-table th:nth-child(4),
    .contact-table td:nth-child(4) { width: 180px; }  /* Email */
    .contact-table th:nth-child(5),
    .contact-table td:nth-child(5) { width: 200px; }  /* 件名 */
    .contact-table th:nth-child(6),
    .contact-table td:nth-child(6) { width: 90px; }   /* ステータス */
    .contact-table th:nth-child(7),
    .contact-table td:nth-child(7) { width: auto; }   /* 操作 */

    .contact-actions {
		display: flex;
		align-items: center;
		width: 100%; 
    }
	

	.contact-actions form {
	  margin-left: auto;
	  padding-left: 8px;
	}

	
	.contact-actions a {
	  margin-right: 8px;
	}
	
	.contact-table td:last-child {
	  position: relative;
	}

	.contact-table td:last-child::before {
	  content: "";
	  position: absolute;
	  top: 4px;
	  bottom: 4px;
	  left: 50%;
	  border-left: 1px solid #ccc;
	}

    .btn-delete {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid #c00;
      background-color: #fff;
      color: #c00;
      cursor: pointer;
    }
    .btn-delete:hover {
      background-color: #ffe5e5;
    }
  </style>
</th:block>

</html>
