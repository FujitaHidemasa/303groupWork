<!-- ============================================================
  注文管理（Wireframe Version）
  現在はDB未連携のため、仮データを静的に表示しています。

  【今後の実装方針】
  ・このページでは全ユーザーの注文履歴を一覧表示し、
    ユーザー名、商品名、価格、購入日時などを確認できるようにします。
  ・管理画面専用の Controller（AdminOrderController）を追加。
  ・Service/Mapper は既存の OrderService / OrderMapper を再利用します。
  ・Spring Security により /admin/** を認可制限予定。
============================================================= -->

<!-- ============================================================
				注文管理（DB連携版）
============================================================= -->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja"
	th:replace="layout/admin_base :: admin_base(~{::content}, '注文管理', ~{::assets})">


<th:block th:fragment="content">
	<section class="section">
		<h1>注文管理</h1>

		<!-- 注文がない場合 -->
		<p th:if="${#lists.isEmpty(orderLists)}" style="margin-bottom:16px; color:#666;">
			現在、登録されている注文はありません。
		</p>

		<!-- フラッシュメッセージ（ステータス更新結果など） -->
		<p th:if="${successMessage != null}" th:text="${successMessage}" style="color: #0a0; margin-bottom: 12px;"></p>

		<!-- 注文一覧テーブル -->
		<div class="table-container" th:if="${!#lists.isEmpty(orderLists)}">
			<table>
				<thead>
					<tr>
						<th>注文ID</th>
						<th>注文日</th>
						<th>最終更新</th>
						<th>会員ID</th>
						<th>支払い方法</th>
						<th>配達希望</th>
						<th>商品点数</th>
						<th>合計金額（商品小計）</th>
						<th>ステータス</th>
						<th>詳細</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="ol : ${orderLists}">
						<!-- 注文ID -->
						<td th:text="${ol.id}">1001</td>

						<!-- 注文日 -->
						<td th:text="${#temporals.format(ol.createdAt, 'yyyy/MM/dd HH:mm')}">
							2025/11/01 10:00
						</td>

						<!-- 最終更新日時 -->
						<td
							th:text="${ol.updatedAt != null ? #temporals.format(ol.updatedAt, 'yyyy/MM/dd HH:mm') : '-'}">
							2025/11/02 12:00
						</td>

						<!-- 会員ID（login_user.username） -->
						<td th:text="${ol.username}">sample_user</td>

						<!-- 支払い方法 -->
						<td th:text="${ol.paymentMethod}">着払い</td>

						<!-- 配達希望 -->
						<td>
							<span th:if="${ol.deliveryDate != null}"
								th:text="${#temporals.format(ol.deliveryDate, 'yyyy/MM/dd')}"></span>
							<span th:if="${ol.deliveryTime != null}" th:text="${' ' + ol.deliveryTime}"></span>
						</td>

						<!-- 商品点数（Order.quantity の合計） -->
						<td th:text="${itemCountMap[ol.id]} + '点'">3点</td>

						<!-- 合計金額（商品小計） -->
						<td th:text="${#numbers.formatInteger(totalPriceMap[ol.id], 1, 'COMMA')} + '円'">
							8,200円
						</td>

						<!-- ステータス（未出荷 / 出荷済み）-->
						<td>
							<form th:action="@{/admin/orders/{id}/status(id=${ol.id})}" method="post"
								class="status-form">
								<!-- CSRFトークン -->
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

								<select name="status">
									<option value="NEW" th:selected="${ol.status == 'NEW'}">注文受付</option>
									<option value="SHIPPED" th:selected="${ol.status == 'SHIPPED'}">出荷済み</option>
									<option value="CANCELLED" th:selected="${ol.status == 'CANCELLED'}">キャンセル</option>
								</select>
								<button type="submit" class="btn btn-edit btn-small">更新</button>
							</form>
						</td>

						<!-- 詳細ボタン -->
						<td>
							<a class="btn btn-edit"
								th:href="@{/admin/orders/{id}(id=${ol.id})}">
								詳細
							</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</section>
</th:block>

</html>