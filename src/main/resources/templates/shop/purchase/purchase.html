<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" th:href="@{/css/ec/main.css}">
	<link rel="stylesheet" th:href="@{/css/ec/header.css}">
	<link rel="stylesheet" th:href="@{/css/ec/footer.css}">
	<title>購入画面 - FPS GEAR STORE</title>
	<style>
		table {
			border-collapse: collapse;
			width: 100%;
			margin-top: 20px;
		}

		th,
		td {
			padding: 12px 14px;
			border-bottom: 1px solid #ccc;
			text-align: center;
			vertical-align: middle;
		}

		th {
			background-color: #f5f5f5;
			color: black;
		}

		img {
			display: block;
			margin: 0 auto;
		}

		tbody tr {
			height: 120px;
		}

		.purchase-actions {
			margin-top: 30px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-top: 1px solid #ccc;
			padding-top: 15px;
		}

		select,
		input[type="text"],
		input[type="date"] {
			padding: 6px 10px;
			font-size: 1rem;
			border: 1px solid #aaa;
			border-radius: 4px;
		}

		.purchase-actions button {
			padding: 10px 20px;
			background-color: #ccc;
			border: none;
			cursor: pointer;
		}

		.purchase-actions button:hover {
			background-color: #bbb;
		}

		h2 {
			margin-top: 20px;
			text-align: center;
		}

		label {
			font-weight: bold;
		}
	</style>
</head>

<body>
	<div th:replace="fragments/header :: header"></div>

	<main>
		<section>
			<h2>購入画面</h2>

			<!-- メッセージ（カート空 / 全て販売終了 等） -->
			<p th:if="${message}" th:text="${message}"
				style="margin-top:10px; text-align:center; color:#c00;"></p>

			<!-- カートに販売終了品が含まれている場合の注意書き -->
			<p th:if="${hasDeletedItems}"
				style="margin-top:5px; text-align:center; color:#c00; font-size:0.9rem;">
				※ カート内に販売終了の商品がありましたが、これらは購入内容には含まれていません。
			</p>

			<!-- 商品一覧 -->
			<table>
				<thead>
					<tr>
						<th>商品画像</th>
						<th>商品名</th>
						<th>数量</th>
						<th>価格</th>
						<th>小計</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="cv : ${cartItems}">
						<td>
							<img th:src="@{'/images/' + ${cv.item.thumbsImageName}}"
								onerror="this.onerror=null;this.src='/images/no_image.png';" alt="商品画像" width="80"
								height="80" style="object-fit: cover;">
						</td>

						<td th:text="${cv.item.name}">商品名</td>
						<td th:text="${cv.cart.quantity}">1</td>
						<td th:text="${#numbers.formatInteger(cv.item.price, 1, 'COMMA')} + '円'">0円</td>
						<td th:text="${#numbers.formatInteger(cv.item.price * cv.cart.quantity, 1, 'COMMA')} + '円'">0円
						</td>
					</tr>
				</tbody>
			</table>

			<!-- 購入情報入力 -->
			<form th:action="@{/voidrshop/purchase/confirm}" method="post">
				<div class="purchase-actions">
					<a th:href="@{/voidrshop/cart}">カートに戻る</a>
					<div>
						<label for="paymentMethod">支払い方法：</label>
						<select id="paymentMethod" name="paymentMethod" required>
							<option value="着払い" selected>着払い</option>
							<option value="銀行振込">銀行振込</option>
							<option value="コンビニ払い">コンビニ払い</option>
						</select>

						<br><br>
						<label for="address">配送先住所：</label>
						<input type="text" id="address" name="address" placeholder="例：東京都渋谷区1-2-3" required
							style="width:300px; margin-left:10px;">

						<br><br>
						<!-- 配達希望日 -->
						<label for="deliveryDate"><strong>配達希望日：</strong></label>
						<select id="deliveryDate" name="deliveryDate" style="margin-left:10px;" required>
							<option value="" disabled selected>--選択してください--</option>
							<option th:each="date : ${deliveryOptions}"
								th:value="${#temporals.format(date,'yyyy-MM-dd')}"
								th:text="${#temporals.format(date,'yyyy年MM月dd日 (E)')}">
							</option>
						</select>

						<br><br>
						<!-- 配達希望時間帯 -->
						<label for="deliveryTime">配達希望時間帯：</label>
						<select id="deliveryTime" name="deliveryTime" style="margin-left:10px;" required>
							<option value="" disabled selected>--選択してください--</option>
							<option value="午前中" th:selected="${deliveryTime == '午前中'}">午前中</option>
							<option value="12時～14時" th:selected="${deliveryTime == '12時～14時'}">12時～14時</option>
							<option value="14時～16時" th:selected="${deliveryTime == '14時～16時'}">14時～16時</option>
							<option value="16時～18時" th:selected="${deliveryTime == '16時～18時'}">16時～18時</option>
							<option value="18時～20時" th:selected="${deliveryTime == '18時～20時'}">18時～20時</option>
							<option value="19時～21時" th:selected="${deliveryTime == '19時～21時'}">19時～21時</option>
						</select>

						<br><br>
						<!-- 小計 -->
						<div style="margin-top:10px;">
							<strong>小計：</strong>
							¥<span th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')}">0</span>
						</div>

						<!-- 送料 -->
						<div>
							<strong>送料：</strong>
							<span
								th:text="${shippingFee == 0 ? '無料' : '¥' + #numbers.formatInteger(shippingFee, 1, 'COMMA')}">¥500</span>
						</div>

						<!-- 総支払額（送料込み） -->
						<div style="margin-top:5px; font-size:1.2rem;">
							<strong>合計金額：</strong>
							¥<span th:text="${#numbers.formatInteger(finalTotal, 1, 'COMMA')}">0</span>
						</div>

						<button type="submit" style="margin-left:20px;">購入内容確認画面へ</button>
					</div>
				</div>
			</form>
		</section>
	</main>

	<div th:replace="fragments/footer :: footer"></div>
</body>

</html>
