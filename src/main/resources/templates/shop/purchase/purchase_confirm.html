<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" th:href="@{/css/ec/main.css}">
	<link rel="stylesheet" th:href="@{/css/ec/header.css}">
	<link rel="stylesheet" th:href="@{/css/ec/footer.css}">
	<title>購入内容確認 - FPS GEAR STORE</title>
	<style>
		main {
			width: 80%;
			margin: 40px auto;
		}

		h2 {
			text-align: center;
			margin-bottom: 30px;
		}

		table {
			border-collapse: collapse;
			width: 100%;
			margin-top: 20px;
		}

		th,
		td {
			padding: 12px 14px;
			border-bottom: 1px solid #ccc;
			text-align: center;
			vertical-align: middle;
		}

		th {
			background-color: #f5f5f5;
			color: black;
		}

		img {
			display: block;
			margin: 0 auto;
		}

		tbody tr {
			height: 120px;
		}

		/* 支払い情報ボックスを強調表示 */
		.info-section {
			text-align: left;
			background-color: #fafafa;
			border: 1px solid #ccc;
			border-radius: 8px;
			padding: 20px 30px;
			margin: 0 auto 40px;
			width: 60%;
			color: #222;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
		}

		.info-section p {
			font-size: 1.1rem;
			margin: 10px 0;
			color: #111;
		}

		.info-section strong {
			display: inline-block;
			width: 140px;
			color: #000;
		}

		.purchase-actions {
			margin-top: 30px;
			display: flex;
			justify-content: center;
			gap: 20px;
			border-top: 1px solid #ccc;
			padding-top: 20px;
		}

		button {
			padding: 10px 20px;
			border: none;
			cursor: pointer;
			font-size: 1rem;
			border-radius: 6px;
		}

		.btn-confirm {
			background-color: #28a745;
			color: white;
		}

		.btn-confirm:hover {
			background-color: #218838;
		}

		.btn-back {
			background-color: #ccc;
			color: black;
		}

		.btn-back:hover {
			background-color: #bbb;
		}
	</style>
</head>

<body>
	<div th:replace="fragments/header :: header"></div>

	<main>
		<section>
			<h2>購入内容の確認</h2>

			<!-- 販売終了品があった場合の注意 -->
			<p th:if="${hasDeletedItems}"
				style="text-align:center; color:#c00; margin-bottom:10px; font-size:0.9rem;">
				※ カート内に販売終了の商品がありましたが、これらは注文内容に含まれていません。
			</p>

			<!-- 支払い方法・住所・配達希望日（表示用） -->
			<div class="info-section">
				<p><strong>支払い方法：</strong><span th:text="${paymentMethod}">着払い</span></p>
				<p><strong>配送先住所：</strong><span th:text="${address}">大阪府大阪市島之内</span></p>
				<p><strong>配達希望日：</strong><span th:text="${deliveryDate}">2025-11-13</span></p>
				<p><strong>配達希望時間：</strong><span th:text="${deliveryTime}">指定なし</span></p>
			</div>

			<!-- 商品一覧 -->
			<table>
				<thead>
					<tr>
						<th>商品画像</th>
						<th>商品名</th>
						<th>数量</th>
						<th>価格</th>
						<th>小計</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="cv : ${cartItems}">
						<td>
							<img th:src="@{'/images/' + ${cv.item.thumbsImageName}}"
								onerror="this.onerror=null;this.src='/images/no_image.png';" alt="商品画像" width="80"
								height="80" style="object-fit: cover;">
						</td>

						<td th:text="${cv.item.name}">商品名</td>
						<td th:text="${cv.cart.quantity}">1</td>
						<td th:text="${#numbers.formatInteger(cv.item.price, 1, 'COMMA')} + '円'">0円</td>
						<td th:text="${#numbers.formatInteger(cv.item.price * cv.cart.quantity, 1, 'COMMA')} + '円'">0円
						</td>
					</tr>
				</tbody>
			</table>

			<p class="fs-4 fw-bold text-center" style="margin-top: 20px;">
				商品小計：
				<span th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')}"></span>円（税込）
			</p>

			<p class="fs-5 text-center" style="margin-top: 5px;">
				送料：
				<span
					th:text="${shippingFee == 0 ? '無料' : #numbers.formatInteger(shippingFee, 1, 'COMMA') + '円'}"></span>
			</p>

			<p class="fs-3 fw-bold text-center" style="margin-top: 10px;">
				支払金額合計：
				<span th:text="${#numbers.formatInteger(finalTotal, 1, 'COMMA')}"></span>円
			</p>


			<!-- 購入確定ボタン -->
			<div class="purchase-actions">
				<form th:action="@{/voidrshop/purchase/complete}" method="post">
					<!-- hidden で全ての情報を送信 -->
					<input type="hidden" name="paymentMethod" th:value="${paymentMethod}">
					<input type="hidden" name="address" th:value="${address}">
					<input type="hidden" name="deliveryDate" th:value="${deliveryDate}">
					<input type="hidden" name="deliveryTime" th:value="${deliveryTime}">
					<button type="submit" class="btn-confirm">購入を確定する</button>
				</form>

				<form th:action="@{/voidrshop/purchase}" method="get">
					<button type="submit" class="btn-back">戻る</button>
				</form>
			</div>
		</section>
	</main>

	<div th:replace="fragments/footer :: footer"></div>
</body>

</html>
